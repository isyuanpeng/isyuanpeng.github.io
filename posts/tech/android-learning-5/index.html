<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Android Learning 5 | Isyuanpeng</title>
<meta name="keywords" content="android" />
<meta name="description" content="今天学习android的数据库和协程
ROOM
ROOM类似于JPA，能够定义DAO层使用预置的方法进行数据的操作。ROOM主要包含下面三个组件：


Database数据库类: 用于保存数据库并作为应用持久性数据底层连接的主要访问点。其实我感觉Database的类就是提供了Dao层的实例。


Entity实体类：用于表示应用的数据库中的表。


Dao类：提供您的应用可用于查询、更新、插入和删除数据库中的数据的方法。类似于Spring中的Dao层，定义了操作数据库的方法。


Entity
实体类就是我们常见的实体类，使用的注解也和JPA类似


@Entity(tableName = &ldquo;users&rdquo;)：该注解说明该类是一个实体类，并且关联了users的表


@PrimaryKey：用于字段上，说明该字段是主键


@ColumnInfo(name = &ldquo;last_name&rdquo;)：用于字段上，绑定实体类中的属性和表中的字段




1
2
3
4
5
6


@Entity(tableName = &#34;users&#34;)
data class User (
    @PrimaryKey val id: Int,
    @ColumnInfo(name = &#34;first_name&#34;) val firstName: String?,
    @ColumnInfo(name = &#34;last_name&#34;) val lastName: String?
)


Dao
在Dao类中定义方法来操作数据库。下面是一个简单样例：">
<meta name="author" content="YuanPeng11">
<link rel="canonical" href="https://isyuanpeng.github.io/posts/tech/android-learning-5/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.7bdb1411b29ec9fed2b6395a081eabcb3262e7311bda855249d433c8b30a926e.css" integrity="sha256-e9sUEbKeyf7StjlaCB6ryzJi5zEb2oVSSdQzyLMKkm4=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js" integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://isyuanpeng.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://isyuanpeng.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://isyuanpeng.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://isyuanpeng.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://isyuanpeng.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.140.0">
<link rel="alternate" hreflang="en" href="https://isyuanpeng.github.io/posts/tech/android-learning-5/" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Android Learning 5" />
<meta property="og:description" content="今天学习android的数据库和协程
ROOM
ROOM类似于JPA，能够定义DAO层使用预置的方法进行数据的操作。ROOM主要包含下面三个组件：


Database数据库类: 用于保存数据库并作为应用持久性数据底层连接的主要访问点。其实我感觉Database的类就是提供了Dao层的实例。


Entity实体类：用于表示应用的数据库中的表。


Dao类：提供您的应用可用于查询、更新、插入和删除数据库中的数据的方法。类似于Spring中的Dao层，定义了操作数据库的方法。


Entity
实体类就是我们常见的实体类，使用的注解也和JPA类似


@Entity(tableName = &ldquo;users&rdquo;)：该注解说明该类是一个实体类，并且关联了users的表


@PrimaryKey：用于字段上，说明该字段是主键


@ColumnInfo(name = &ldquo;last_name&rdquo;)：用于字段上，绑定实体类中的属性和表中的字段




1
2
3
4
5
6


@Entity(tableName = &#34;users&#34;)
data class User (
    @PrimaryKey val id: Int,
    @ColumnInfo(name = &#34;first_name&#34;) val firstName: String?,
    @ColumnInfo(name = &#34;last_name&#34;) val lastName: String?
)


Dao
在Dao类中定义方法来操作数据库。下面是一个简单样例：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://isyuanpeng.github.io/posts/tech/android-learning-5/" /><meta property="og:image" content="https://isyuanpeng.github.io/papermod-cover.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-29T17:47:49&#43;08:00" />
<meta property="article:modified_time" content="2022-03-29T17:47:49&#43;08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://isyuanpeng.github.io/papermod-cover.png"/>

<meta name="twitter:title" content="Android Learning 5"/>
<meta name="twitter:description" content="今天学习android的数据库和协程
ROOM
ROOM类似于JPA，能够定义DAO层使用预置的方法进行数据的操作。ROOM主要包含下面三个组件：


Database数据库类: 用于保存数据库并作为应用持久性数据底层连接的主要访问点。其实我感觉Database的类就是提供了Dao层的实例。


Entity实体类：用于表示应用的数据库中的表。


Dao类：提供您的应用可用于查询、更新、插入和删除数据库中的数据的方法。类似于Spring中的Dao层，定义了操作数据库的方法。


Entity
实体类就是我们常见的实体类，使用的注解也和JPA类似


@Entity(tableName = &ldquo;users&rdquo;)：该注解说明该类是一个实体类，并且关联了users的表


@PrimaryKey：用于字段上，说明该字段是主键


@ColumnInfo(name = &ldquo;last_name&rdquo;)：用于字段上，绑定实体类中的属性和表中的字段




1
2
3
4
5
6


@Entity(tableName = &#34;users&#34;)
data class User (
    @PrimaryKey val id: Int,
    @ColumnInfo(name = &#34;first_name&#34;) val firstName: String?,
    @ColumnInfo(name = &#34;last_name&#34;) val lastName: String?
)


Dao
在Dao类中定义方法来操作数据库。下面是一个简单样例："/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://isyuanpeng.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Android Learning 5",
      "item": "https://isyuanpeng.github.io/posts/tech/android-learning-5/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Android Learning 5",
  "name": "Android Learning 5",
  "description": "今天学习android的数据库和协程\nROOM ROOM类似于JPA，能够定义DAO层使用预置的方法进行数据的操作。ROOM主要包含下面三个组件：\nDatabase数据库类: 用于保存数据库并作为应用持久性数据底层连接的主要访问点。其实我感觉Database的类就是提供了Dao层的实例。\nEntity实体类：用于表示应用的数据库中的表。\nDao类：提供您的应用可用于查询、更新、插入和删除数据库中的数据的方法。类似于Spring中的Dao层，定义了操作数据库的方法。\nEntity 实体类就是我们常见的实体类，使用的注解也和JPA类似\n@Entity(tableName = \u0026ldquo;users\u0026rdquo;)：该注解说明该类是一个实体类，并且关联了users的表\n@PrimaryKey：用于字段上，说明该字段是主键\n@ColumnInfo(name = \u0026ldquo;last_name\u0026rdquo;)：用于字段上，绑定实体类中的属性和表中的字段\n1 2 3 4 5 6 @Entity(tableName = \u0026#34;users\u0026#34;) data class User ( @PrimaryKey val id: Int, @ColumnInfo(name = \u0026#34;first_name\u0026#34;) val firstName: String?, @ColumnInfo(name = \u0026#34;last_name\u0026#34;) val lastName: String? ) Dao 在Dao类中定义方法来操作数据库。下面是一个简单样例：\n",
  "keywords": [
    "android"
  ],
  "articleBody": "今天学习android的数据库和协程\nROOM ROOM类似于JPA，能够定义DAO层使用预置的方法进行数据的操作。ROOM主要包含下面三个组件：\nDatabase数据库类: 用于保存数据库并作为应用持久性数据底层连接的主要访问点。其实我感觉Database的类就是提供了Dao层的实例。\nEntity实体类：用于表示应用的数据库中的表。\nDao类：提供您的应用可用于查询、更新、插入和删除数据库中的数据的方法。类似于Spring中的Dao层，定义了操作数据库的方法。\nEntity 实体类就是我们常见的实体类，使用的注解也和JPA类似\n@Entity(tableName = “users”)：该注解说明该类是一个实体类，并且关联了users的表\n@PrimaryKey：用于字段上，说明该字段是主键\n@ColumnInfo(name = “last_name”)：用于字段上，绑定实体类中的属性和表中的字段\n1 2 3 4 5 6 @Entity(tableName = \"users\") data class User ( @PrimaryKey val id: Int, @ColumnInfo(name = \"first_name\") val firstName: String?, @ColumnInfo(name = \"last_name\") val lastName: String? ) Dao 在Dao类中定义方法来操作数据库。下面是一个简单样例：\n1 2 3 4 5 6 7 8 9 10 11 @Dao interface UserDao { @Insert fun insertAll(vararg users: User) @Delete fun delete(user: User) @Query(\"SELECT * FROM user\") fun getAll(): List\u003cUser\u003e } 可以看到提供了Insert和Delete的注解，不需要编码sql语句即可完成数据库操作，和JPA类似。\n@Insert 和 @Update: insert和update就是插入和更新，参数为实体类\n@Delete: 以实体类为参数删除实体，实体类中必须包含主键\n@Query: query就直接可以写原生的sql去查询或者去进行数据库的操作\nDatabase 关于Database类有点不太理解，已经有了Dao层去完成数据库操作，只需要在ViewModel中去引入Dao层然后操作即可，为什么还有要Database呢？下面是官方的样例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 @Database(entities = [SleepNight::class], version = 1, exportSchema = false) abstract class SleepDatabase : RoomDatabase() { abstract val sleepDatabaseDao: SleepDatabaseDao companion object { @Volatile private var INSTANCE: SleepDatabase? = null fun getInstance(context: Context): SleepDatabase { synchronized(this) { var instance = INSTANCE if (instance == null) { instance = Room.databaseBuilder( context.applicationContext, SleepDatabase::class.java, \"sleep_history_database\" ) .fallbackToDestructiveMigration() .build() INSTANCE = instance } return instance } } } }// Song and Album are classes annotated with @Entity. @Database(version = 1, entities = {Song.class, Album.class}) abstract class MusicDatabase : RoomDatabase { // SongDao is a class annotated with @Dao. abstract fun getSongDao(): SongDao // AlbumDao is a class annotated with @Dao. abstract fun getArtistDao(): ArtistDao // SongAlbumDao is a class annotated with @Dao. abstract fun getSongAlbumDao(): SongAlbumDao } 可以看到使用了@Database的注解，包含了版本号，以及实体类，这里的实体类比较好理解，是下面引用的Dao类的实体类。那么版本号呢？\n版本号用户数据库表结构的更新，如果数据库表结构变更了，则需要变更版本号，然后设置Database的实例创建增加fallbackToDestructiveMigration配置就可以了。\n但是这样做会有缺点，所有的数表都会被删掉，所以需要使用迁移功能。\n迁移功能在更新版本号的同事还需要重写migrate方法然后将表结构更改的语句加上即可，如下.\n1 2 3 4 5 6 7 8 static final Migration MIGRATION_1_2 = new Migration(1, 2) { @Override public void migrate(SupportSQLiteDatabase database) { //此处对于数据库中的所有更新都需要写下面的代码 database.execSQL(\"ALTER TABLE users \" + \" ADD COLUMN last_update INTEGER\"); } }; 加完之后database的实例加上.addMigrations(MIGRATION_1_2)就完成了。\n协程 一般java使用多线程来处理业务量比较大的操作，那么在android+kotlin里面使用协程来操作。\n如果一个应用必须等待某项任务完成后才能继续，那么系统可能会阻止其正常执行。例如，读取大文件或执行冗长的数据库调用就是可能会阻止或“阻塞”整个应用执行的任务。这样不仅会降低应用对用户的响应能力，而且也不能高效地利用硬件。执行长时间运行的任务而不阻塞主线程的一种模式是使用回调。这是一种有用的模式，但它有一些缺点。有关这些概念的介绍，请参阅多线程和回调入门指南。\n有关于协程的知识，官方解释的很清楚：\n在 Kotlin 中，使用协程来顺畅且高效地处理长时间运行的任务，而不是回调。Kotlin 协程使您能够将基于回调的代码转换为顺序代码。顺序编写的代码通常更易于阅读和维护。与回调不同，协程可以安全地使用有价值的语言功能，如异常。最重要的是，协程具有更高程度的可维护性和灵活性。最后，协程和回调执行相同的功能：它们都能够处理应用中可能长时间运行的异步任务。\n简而言之，对于需要回调的方法来说，使用协程可以不等回调，顺序执行。\n有关协程的操作可以看官方文档:\nhttps://kotlinlang.org/docs/coroutines-guide.html\n协程在android中的使用 如room中的操作，对于数据库的操作完全可以使用协程后台操作。所以上述的简单样例可以改成这样：\n1 2 3 4 5 6 7 8 9 10 11 @Dao interface UserDao { @Insert suspend fun insertAll(vararg users: User) @Delete suspend delete(user: User) @Query(\"SELECT * FROM user\") suspend getAll(): List\u003cUser\u003e } 更多的协程的知识，请看系列博文：\nhttps://juejin.cn/post/6953441828100112392\n",
  "wordCount" : "342",
  "inLanguage": "en",
  "datePublished": "2022-03-29T17:47:49+08:00",
  "dateModified": "2022-03-29T17:47:49+08:00",
  "author":[{
    "@type": "Person",
    "name": "YuanPeng11"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://isyuanpeng.github.io/posts/tech/android-learning-5/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Isyuanpeng",
    "logo": {
      "@type": "ImageObject",
      "url": "https://isyuanpeng.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://isyuanpeng.github.io/" accesskey="h" title="Isyuanpeng (Alt + H)">Isyuanpeng</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://isyuanpeng.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://isyuanpeng.github.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://isyuanpeng.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://isyuanpeng.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://isyuanpeng.github.io/series/" title="Series">
                    <span>Series</span>
                </a>
            </li>
            <li>
                <a href="https://isyuanpeng.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://isyuanpeng.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://isyuanpeng.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Android Learning 5
    </h1>
    <div class="post-meta">&lt;span title=&#39;2022-03-29 17:47:49 &#43;0800 &#43;0800&#39;&gt;March 29, 2022&lt;/span&gt;&amp;nbsp;·&amp;nbsp;2 min&amp;nbsp;·&amp;nbsp;YuanPeng11

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#room" aria-label="ROOM">ROOM</a><ul>
                            
                    <li>
                        <a href="#entity" aria-label="Entity">Entity</a></li>
                    <li>
                        <a href="#dao" aria-label="Dao">Dao</a></li>
                    <li>
                        <a href="#database" aria-label="Database">Database</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%8d%8f%e7%a8%8b" aria-label="协程">协程</a><ul>
                            
                    <li>
                        <a href="#%e5%8d%8f%e7%a8%8b%e5%9c%a8android%e4%b8%ad%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="协程在android中的使用">协程在android中的使用</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>今天学习android的数据库和协程</p>
<h2 id="room">ROOM<a hidden class="anchor" aria-hidden="true" href="#room">#</a></h2>
<p>ROOM类似于JPA，能够定义DAO层使用预置的方法进行数据的操作。ROOM主要包含下面三个组件：</p>
<ol>
<li>
<p>Database数据库类: 用于保存数据库并作为应用持久性数据底层连接的主要访问点。其实我感觉Database的类就是提供了Dao层的实例。</p>
</li>
<li>
<p>Entity实体类：用于表示应用的数据库中的表。</p>
</li>
<li>
<p>Dao类：提供您的应用可用于查询、更新、插入和删除数据库中的数据的方法。类似于Spring中的Dao层，定义了操作数据库的方法。</p>
</li>
</ol>
<h3 id="entity">Entity<a hidden class="anchor" aria-hidden="true" href="#entity">#</a></h3>
<p>实体类就是我们常见的实体类，使用的注解也和JPA类似</p>
<ul>
<li>
<p>@Entity(tableName = &ldquo;users&rdquo;)：该注解说明该类是一个实体类，并且关联了users的表</p>
</li>
<li>
<p>@PrimaryKey：用于字段上，说明该字段是主键</p>
</li>
<li>
<p>@ColumnInfo(name = &ldquo;last_name&rdquo;)：用于字段上，绑定实体类中的属性和表中的字段</p>
</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>@Entity(tableName = &#34;users&#34;)
</span></span><span style="display:flex;"><span>data class User (
</span></span><span style="display:flex;"><span>    @PrimaryKey val id: Int,
</span></span><span style="display:flex;"><span>    @ColumnInfo(name = &#34;first_name&#34;) val firstName: String?,
</span></span><span style="display:flex;"><span>    @ColumnInfo(name = &#34;last_name&#34;) val lastName: String?
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dao">Dao<a hidden class="anchor" aria-hidden="true" href="#dao">#</a></h3>
<p>在Dao类中定义方法来操作数据库。下面是一个简单样例：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>Dao
</span></span><span style="display:flex;"><span>interface UserDao {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span>Insert
</span></span><span style="display:flex;"><span>    fun insertAll(vararg users: User)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span>Delete
</span></span><span style="display:flex;"><span>    fun delete(user: User)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span>Query(<span style="color:#e6db74">&#34;SELECT * FROM user&#34;</span>)
</span></span><span style="display:flex;"><span>    fun getAll(): List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到提供了Insert和Delete的注解，不需要编码sql语句即可完成数据库操作，和JPA类似。</p>
<ul>
<li>
<p>@Insert 和 @Update: insert和update就是插入和更新，参数为实体类</p>
</li>
<li>
<p>@Delete: 以实体类为参数删除实体，实体类中必须包含主键</p>
</li>
<li>
<p>@Query: query就直接可以写原生的sql去查询或者去进行数据库的操作</p>
</li>
</ul>
<h3 id="database">Database<a hidden class="anchor" aria-hidden="true" href="#database">#</a></h3>
<p>关于Database类有点不太理解，已经有了Dao层去完成数据库操作，只需要在ViewModel中去引入Dao层然后操作即可，为什么还有要Database呢？下面是官方的样例：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>Database(entities <span style="color:#f92672">=</span> [SleepNight::<span style="color:#66d9ef">class</span>], version <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, exportSchema <span style="color:#f92672">=</span> false)
</span></span><span style="display:flex;"><span>abstract <span style="color:#66d9ef">class</span> SleepDatabase : RoomDatabase() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    abstract val sleepDatabaseDao: SleepDatabaseDao
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    companion object {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">@</span>Volatile
</span></span><span style="display:flex;"><span>        private <span style="color:#66d9ef">var</span> INSTANCE: SleepDatabase<span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#f92672">=</span> null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        fun getInstance(context: Context): SleepDatabase {
</span></span><span style="display:flex;"><span>            synchronized(this) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">var</span> instance <span style="color:#f92672">=</span> INSTANCE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (instance <span style="color:#f92672">==</span> null) {
</span></span><span style="display:flex;"><span>                    instance <span style="color:#f92672">=</span> <span style="color:#a6e22e">Room</span><span style="color:#f92672">.</span>databaseBuilder(
</span></span><span style="display:flex;"><span>                            context<span style="color:#f92672">.</span>applicationContext,
</span></span><span style="display:flex;"><span>                            SleepDatabase::<span style="color:#66d9ef">class</span><span style="color:#f92672">.</span>java,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;sleep_history_database&#34;</span>
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">.</span>fallbackToDestructiveMigration()
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">.</span>build()
</span></span><span style="display:flex;"><span>                    INSTANCE <span style="color:#f92672">=</span> instance
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> instance
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}<span style="color:#f92672">//</span> Song <span style="color:#f92672">and</span> Album are classes annotated with <span style="color:#960050;background-color:#1e0010">@</span>Entity<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>Database(version <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, entities <span style="color:#f92672">=</span> {Song<span style="color:#f92672">.</span><span style="color:#66d9ef">class</span>, Album<span style="color:#f92672">.</span><span style="color:#66d9ef">class</span>})
</span></span><span style="display:flex;"><span>abstract <span style="color:#66d9ef">class</span> MusicDatabase : RoomDatabase {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> SongDao is a <span style="color:#66d9ef">class</span> annotated with <span style="color:#960050;background-color:#1e0010">@</span>Dao<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  abstract fun getSongDao(): SongDao
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> AlbumDao is a <span style="color:#66d9ef">class</span> annotated with <span style="color:#960050;background-color:#1e0010">@</span>Dao<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  abstract fun getArtistDao(): ArtistDao
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> SongAlbumDao is a <span style="color:#66d9ef">class</span> annotated with <span style="color:#960050;background-color:#1e0010">@</span>Dao<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  abstract fun getSongAlbumDao(): SongAlbumDao
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到使用了@Database的注解，包含了版本号，以及实体类，这里的实体类比较好理解，是下面引用的Dao类的实体类。那么版本号呢？</p>
<p>版本号用户数据库表结构的更新，如果数据库表结构变更了，则需要变更版本号，然后设置Database的实例创建增加fallbackToDestructiveMigration配置就可以了。</p>
<p>但是这样做会有缺点，所有的数表都会被删掉，所以需要使用迁移功能。</p>
<p>迁移功能在更新版本号的同事还需要重写migrate方法然后将表结构更改的语句加上即可，如下.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>static final Migration MIGRATION_1_2 = new Migration(1, 2) {
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    public void migrate(SupportSQLiteDatabase database) {
</span></span><span style="display:flex;"><span>      //此处对于数据库中的所有更新都需要写下面的代码
</span></span><span style="display:flex;"><span>        database.execSQL(&#34;ALTER TABLE users &#34;
</span></span><span style="display:flex;"><span>                + &#34; ADD COLUMN last_update INTEGER&#34;);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></td></tr></table>
</div>
</div><p>加完之后database的实例加上.addMigrations(MIGRATION_1_2)就完成了。</p>
<h2 id="协程">协程<a hidden class="anchor" aria-hidden="true" href="#协程">#</a></h2>
<p>一般java使用多线程来处理业务量比较大的操作，那么在android+kotlin里面使用协程来操作。</p>
<blockquote>
<p>如果一个应用必须等待某项任务完成后才能继续，那么系统可能会阻止其正常执行。例如，读取大文件或执行冗长的数据库调用就是可能会阻止或“阻塞”整个应用执行的任务。这样不仅会降低应用对用户的响应能力，而且也不能高效地利用硬件。执行长时间运行的任务而不阻塞主线程的一种模式是使用回调。这是一种有用的模式，但它有一些缺点。有关这些概念的介绍，请参阅多线程和回调入门指南。</p>
</blockquote>
<p>有关于协程的知识，官方解释的很清楚：</p>
<blockquote>
<p>在 Kotlin 中，使用协程来顺畅且高效地处理长时间运行的任务，而不是回调。Kotlin 协程使您能够将基于回调的代码转换为顺序代码。顺序编写的代码通常更易于阅读和维护。与回调不同，协程可以安全地使用有价值的语言功能，如异常。最重要的是，协程具有更高程度的可维护性和灵活性。最后，协程和回调执行相同的功能：它们都能够处理应用中可能长时间运行的异步任务。</p>
</blockquote>
<p>简而言之，对于需要回调的方法来说，使用协程可以不等回调，顺序执行。</p>
<p>有关协程的操作可以看官方文档:</p>
<blockquote>
<p><a href="https://kotlinlang.org/docs/coroutines-guide.html">https://kotlinlang.org/docs/coroutines-guide.html</a></p>
</blockquote>
<h3 id="协程在android中的使用">协程在android中的使用<a hidden class="anchor" aria-hidden="true" href="#协程在android中的使用">#</a></h3>
<p>如room中的操作，对于数据库的操作完全可以使用协程后台操作。所以上述的简单样例可以改成这样：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>Dao
</span></span><span style="display:flex;"><span>interface UserDao {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span>Insert
</span></span><span style="display:flex;"><span>    suspend fun insertAll(vararg users: User)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span>Delete
</span></span><span style="display:flex;"><span>    suspend delete(user: User)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">@</span>Query(<span style="color:#e6db74">&#34;SELECT * FROM user&#34;</span>)
</span></span><span style="display:flex;"><span>    suspend getAll(): List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>更多的协程的知识，请看系列博文：</p>
<blockquote>
<p><a href="https://juejin.cn/post/6953441828100112392">https://juejin.cn/post/6953441828100112392</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://isyuanpeng.github.io/tags/android/">Android</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://isyuanpeng.github.io/posts/tech/android-learning-6/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Android Learning 6</span>
  </a>
  <a class="next" href="https://isyuanpeng.github.io/posts/tech/android-learning-4/">
    <span class="title">Next Page »</span>
    <br>
    <span>Android Learning 4</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://isyuanpeng.github.io/">Isyuanpeng</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
